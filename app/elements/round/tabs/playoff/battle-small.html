<link rel="import" href="../../../../styles/shared-styles.html">
<link rel="import" href="../../../../bower_components/iron-image/iron-image.html">

<dom-module id="battle-small">
	<template>
		<style is="custom-style" include="shared-styles">
			:host {
				display: block;
				width: 100%;
			}

			.battle-container {
				width: 60%;
				cursor: pointer;
				@apply(--layout-horizontal);
				@apply(--layout-center);
				min-width: 500px;
			}
			.container {
				@apply(--layout-horizontal);
				/*background-color: #7baaf7;*/
			}

			.battle-container:hover {
				background-color: rgba(75, 92, 255, 0.13);
			}
			.profilePicture {
				width: 75px;
				height: 75px;
			}

			span{
				font-weight: bold;
				overflow: hidden;
			}

			.driver-left {
				width: 45%;
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			.driver-right {
				width: 45%;
				@apply(--layout-horizontal-reverse);
				@apply(--layout-center);
			}
			.omt {
				@apply(--layout-flex);
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}
			.versus {
				width: 10%;
			}
			.winner {
				color: green;
			}
		</style>
		<div class="container">
			<div class="flex"></div>
			<div class="battle-container" on-click="_judgeBattle" style$="{{battleStyle}}">
				<div class="driver-left">
					<iron-image class="profilePicture" src="{{_profilePictureUrl(battle.driver1.driver.profilePicture)}}" sizing="contain"></iron-image>
					<span class$="{{_driverNameClass(battle, battle.driver1)}}">{{battle.driver1.ranking}}. {{battle.driver1.driver.firstName}} {{battle.driver1.driver.lastName}}</span>
				</div>
				<div class="versus">VS</div>
				<div class="driver-right">
					<iron-image class="profilePicture" src="{{_profilePictureUrl(battle.driver2.driver.profilePicture)}}" sizing="contain"></iron-image>
					<span class$="{{_driverNameClass(battle, battle.driver2)}}">{{battle.driver2.ranking}}. {{battle.driver2.driver.firstName}} {{battle.driver2.driver.lastName}}</span>
				</div>
			</div>
			<div class="omt">{{omt}}</div>
		</div>
	</template>
	<script>
		Polymer({
			is: 'battle-small',
			properties: {
				battle: {
					type: Object,
					notify: true,
					observer: '_battleSet'
				},
				battleStyle: {
					type: String,
					notify: true,
					value: ''
				},
				omt: {
					type: String,
					notify: true,
					value: ''
				}
			},
			_battleSet: function(){
				if (!this.battle){
					return;
				}
				var omts;
				if (this.battle.runsCompleted % 2 == 0){
					if (!!this.battle.winner){
						//battle has ended and winner was set -> color will be green
						this.battleStyle = 'background-color: rgba(82, 255, 39, 0.35)';
						omts = (this.battle.runsCompleted / 2) - 1;
						if (omts > 0){
							this.omt = 'OMT x ' + omts;
						}
					}else{
						this.battleStyle = '';
						omts = (this.battle.runsCompleted / 2);
						if (omts > 0){
							this.omt = 'OMT x ' + omts;
						}
					}
				}else{
					this.battleStyle = 'background-color: rgba(252, 255, 32, 0.35)';
					omts = (this.battle.runsCompleted - 1) / 2;
					if (omts > 0){
						this.omt = 'OMT x ' + omts;
					}
				}

			},
			_profilePictureUrl: function(id){
				return util.imageLink(id);
			},
			_driverNameClass: function(battle, currentDriver){
				if (battle.winner !== null && battle.winner.driver.id === currentDriver.driver.id){
					return 'winner';
				}
				return '';
			},
			_judgeBattle: function(){
				page('/playoff/battle/judge/' + this.battle.id);
			}
		});
	</script>
</dom-module>