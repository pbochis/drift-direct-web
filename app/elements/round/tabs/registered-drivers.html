<link rel="import" href="../../../styles/shared-styles.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">

<link rel="import" href="../../../elements/championship/view-tabs/drivers/driver-card.html">
<link rel="import" href="../../../elements/qualifiers/qualified-driver-card.html">



<dom-module id="registered-drivers">
	<template>
		<style is="custom-style" include="shared-styles">
			.controls {
				cursor: pointer;
				@apply(--layout-horizontal);
				@apply(--layout-center-center);
			}

			.vertical {
				@apply(--layout-vertical);
			}

			.horizontal-center {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			#row.horizontal-center div {
				@apply(--layout-flex);
			}
			.tableHeader {
				@apply(--layout-horizontal);
			}

			.tableHeader div {
				@apply(--layout-flex);
			}

			#row {
				cursor: pointer;
			}

			.profilePicture {
				width: 50px;
				height: 50px;
			}

			.tableHeader div {
				font-weight: bold;
			}

			paper-material {
				height: auto;
				/*background-color: rgba(252, 255, 32, 0.35);*/
				/*background-color: rgba(82, 255, 39, 0.35);*/
			}

			hr {
				margin: 5px 0;
			}

			#picture-name > span{
				font-weight: bold;
			}
		</style>
		<template is="dom-if" if="{{canAddDrivers}}">
			<paper-material class="controls" on-click="_addDriver">
				<iron-icon icon="add"></iron-icon>
				<span>Register Driver</span>
			</paper-material>
		</template>
		<paper-material elevation="1">
			<!--Trying to mimic a table here-->
			<div id="table" class="vertical">
				<div class="tableHeader">
					<div>Driver</div>
					<div>Car</div>
				</div>
				<hr>
				<template is="dom-repeat" items="{{round.qualifiers}}">
					<div id="row" class="horizontal-center" style$="{{_getRowStyle(item)}}" on-click="_judgeDriver">
						<div id="picture-name" class="horizontal-center">
							<iron-image class="profilePicture" src="{{_profilePictureUrl(item.driver.profilePicture)}}" sizing="contain"></iron-image>
							<span>{{_getTableIndex(index)}}. {{item.driver.firstName}} {{item.driver.lastName}}</span>
						</div>
						<div>{{_getCarDetails(item.driver)}}</div>
					</div>
					<hr>
				</template>
			</div>
		</paper-material>
	</template>
	<script>
		Polymer({
			is: 'registered-drivers',
			properties: {
				round: {
					type: Object,
					notify: true,
					observer: '_roundSet'
				}
			},
			_roundSet: function(){
				//TODO: replace this with `canEditRound` which should be an api call to check permissions
				this.canAddDrivers = util.isOrganizer() || util.isJudge();
			},
			_addDriver: function() {
				page('/register/' + this.round.id);
			},
			_profilePictureUrl: function(id){
				return util.imageLink(id);
			},
			_getTableIndex: function(index){
				return index + 1;
			},
			_getCarDetails: function(driver){
				var driverDetails = driver.driverDetails;
				var car = '';
				if (!!driverDetails.make){
					car += ' ' + driverDetails.make;
				}
				if (!!driverDetails.model){
					car += ' ' + driverDetails.model;
				}

				if (!!driverDetails.horsePower){
					car += ' ' + driverDetails.horsePower + ' HP';
				}
				if (car === ''){
					return '-'
				}
				return car;
			},
			_getRowStyle: function(qualifier){
				if (qualifier.runsCompleted === 2){
					return 'background-color: rgba(82, 255, 39, 0.35)';
				}
				if (qualifier.runsCompleted === 1){
					return 'background-color: rgba(252, 255, 32, 0.35)';
				}
				return '';

			},
			_judgeDriver: function(e){
				var qualifier = e.model.item;
				page('/qualifiers/' + qualifier.id);
			}
		});
	</script>
</dom-module>