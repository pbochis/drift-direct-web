<link rel="import" href="../../../styles/shared-styles.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../elements/shared/dd-ajax.html">
<link rel="import" href="selectable-driver.html">
<!--TODO: do multiple choice of drivers here.-->
<dom-module id="existing-driver">
	<template>
		<style is="custom-style" include="shared-styles">
			paper-radio-button {
				margin: 10px;
			}
			.vertical {
				@apply(--layout-vertical);
			}

			.tableHeader {
				@apply(--layout-horizontal);
			}

			.tableHeader div {
				@apply(--layout-flex);
			}

			paper-material {
				height: auto;
			}

			hr {
				margin: 5px 0;
			}
		</style>

		<dd-ajax
			id="getDrivers"
			method="GET"
			last-response="{{drivers}}">
		</dd-ajax>

		<paper-material elevation="1">
			<!--Trying to mimic a table here-->
			<div id="table" class="vertical">
				<div class="tableHeader">
					<div>Driver</div>
					<div></div>
				</div>
				<hr>
				<template is="dom-repeat" items="{{drivers}}">
					<selectable-driver driver="{{item}}" on-selected-driver="_selectedDriver" on-removed-driver="_removedDriver"></selectable-driver>
					<hr>
				</template>
			</div>
		</paper-material>
	</template>
	<script>
		Polymer({
			is: 'existing-driver',
			properties: {
				drivers: {
					type: Array,
					notify: true
				},
				selectedDrivers: {
					type: Array,
					notify: true,
					reflectToAttribute: true,
					value: []
				},
				selectedItem : {
					type: Object,
					notify: true,
					observer: '_selectionChanged'
				}
			},
			getDrivers: function(roundId){
				this.$.getDrivers.url = util.build('/round/' + roundId + '/desk');
				this.$.getDrivers.generateRequest();
			},
			_selectedDriver: function(event){
				this.push('selectedDrivers', event.detail.id);
				console.log(this.selectedDrivers);
			},
			_removedDriver: function(event){
				var index = this.selectedDrivers.indexOf(event.detail.id);
				if (index >= 0){
					this.splice('selectedDrivers', index, 1);
				}
			},
			clear: function(){
				this.selectedDrivers = [];
				this.drivers = [];
			},
			validate: function(){
				if (this.selectedItem === undefined){
					this.$.noDriverSelected.show();
					return false;
				}
				return true;
			}
		});
	</script>
</dom-module>