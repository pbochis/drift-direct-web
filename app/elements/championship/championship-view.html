<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../elements/shared/dd-ajax.html">
<link rel="import" href="../../bower_components/paper-item/all-imports.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="view-tabs/championship-images.html">
<link rel="import" href="view-tabs/championship-rules.html">
<link rel="import" href="view-tabs/judges/championship-judges.html">
<link rel="import" href="view-tabs/rounds/round-list.html">
<link rel="import" href="view-tabs/drivers/driver-list.html">
<link rel="import" href="view-tabs/news/news-tab.html">
<link rel="import" href="../../elements/shared/description-list/description-list-item.html">
<link rel="import" href="../../elements/shared/description-list/description-list.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="championship-view">
	<template>
		<style include="shared-styles"></style>
		<style>
			:host {
				display: block;
				height: 100%;
				width: 100%;
			}
			paper-material {
				height: 200px;
			}
			.content {
				width: 80%;
				margin: 36px auto;
			}
			iron-icon {
				cursor: pointer;
			}
			iron-icon:active {
				background-color: rgba(148, 167, 206, 0.5);
			}
			paper-tabs{
				box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
				background-color: white;
			}

			paper-tabs paper-tab.iron-selected {
				color: rgba(0, 0, 0, 1);
				background-color: rgba(0, 0, 0, 0.05);
			}
			.horizontal-center {
				@apply(--layout-horizontal);
				@apply(--layout-center);
			}

			.controls {
				cursor: pointer;
				@apply(--layout-horizontal);
				@apply(--layout-center-justified);
			}
			.warning {
				text-align: center;
				vertical-align: middle;
				font-weight: bold;
			}
			.controls > paper-button {
				background-color: whitesmoke;
			}
		</style>
		<dd-ajax
			id="getChampionship"
			method="GET"
			last-response="{{championship}}"
			on-response="onResponse">
		</dd-ajax>

		<dd-ajax
			id="publishChampionship"
			method="POST"
			on-response="_onPublishResponse">
		</dd-ajax>

		<div class="content">
			<paper-material id="generalInfo">
				<div class="horizontal-center">
					<h1>{{championship.name}}</h1>
					<div class="flex"></div>
					<template is="dom-if" if="{{canPublish}}">
						<paper-button raised on-click="_confirmPublish">Publish</paper-button>
					</template>
					<iron-icon icon="create"></iron-icon>
					<iron-icon icon="delete"></iron-icon>
				</div>
				<description-list>
					<description-list-item label="Tickets" value="{{championship.ticketsUrl}}" link></description-list-item>
					<description-list-item label="Published" value="{{championship.published}}"></description-list-item>
					<description-list-item label="Organizer" value="{{_organizerName(championship.organizer.firstName, championship.organizer.lastName)}}"></description-list-item>
				</description-list>
			</paper-material>
			<paper-tabs noink no-slide elevation="1" selected="{{selectedTab}}">
				<paper-tab>News</paper-tab>
				<paper-tab>Images</paper-tab>
				<paper-tab>Rules</paper-tab>
				<paper-tab>Judges</paper-tab>
				<paper-tab>Rounds</paper-tab>
				<paper-tab>Drivers</paper-tab>
			</paper-tabs>

			<iron-pages selected="{{selectedTab}}">
				<news-tab championship="{{championship}}"></news-tab>
				<championship-images championship="{{championship}}"></championship-images>
				<championship-rules rules="{{championship.rules}}"></championship-rules>
				<championship-judges judges="{{championship.judges}}"></championship-judges>
				<round-list rounds="{{championship.rounds}}"></round-list>
				<driver-list drivers="{{championship.drivers}}"></driver-list>
			</iron-pages>
		</div>
		<paper-dialog id="confirmDialog" modal>
			<div class="warning">Are you sure you want to publish the championship? It will be visible for any users of the app</div>
			<div class="controls">
				<paper-button raised autofocus on-click="_publish">Yes</paper-button>
				<paper-button raised dialog-dismiss>No</paper-button>
			</div>
		</paper-dialog>
	</template>
	<script>
		Polymer({
			is: 'championship-view',
			properties: {
				championship: {
					type: Object,
					notify: true
				},
				selectedTab: {
					type: Number,
					notify: true,
					value: 0
				},
				canPublish: {
					type: Boolean,
					notify: true,
					value: false
				}
			},
			_organizerName: function(firstName, lastName){
				return firstName + ' ' + lastName;
			},
			getChampionship: function(championshipId){
				this.$.getChampionship.url = util.build('/championship/' + championshipId);
				this.$.getChampionship.generateRequest();
			},
			onResponse: function(){
				app.header = this.championship.name;
				this.canPublish = util.isOrganizer() && this.championship.published === false;
			},
			_confirmPublish: function(){
				this.$.confirmDialog.open();
			},
			_publish: function(){
				this.$.confirmDialog.close();
				this.$.publishChampionship.url = util.build('/championship/' + this.championship.id + '/publish');
				this.$.publishChampionship.generateRequest();
			},
			_onPublishResponse: function(){
				this.getChampionship(this.championship.id);
			}
		});
	</script>
</dom-module>